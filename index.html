<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>케이트립 갓생 플랫폼</title>
  <!-- AdSense script: insert into head to load ads library -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8900421212808751"
          crossorigin="anonymous"></script>

  <!-- Meta verification placeholder (replace content with your code) -->
  <meta name="google-adsense-account" content="ca-pub-8900421212808751">

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--cell-size:44px;--gap:12px;--max-width:1100px;--accent:#0b57d0}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;padding:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Nanum Gothic', Arial, sans-serif;background:linear-gradient(180deg,#fbfcff 0%, #f6f9ff 100%);color:#1b2330}
    .wrap{max-width:var(--max-width);margin:28px auto;padding:26px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#3aa0ff);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:1.1rem}
    h1{margin:0;font-size:1.5rem}
    nav a{color:#374151;text-decoration:none;margin-left:14px;font-weight:600}
    .hero{margin-top:18px;background:linear-gradient(90deg,rgba(11,87,208,0.06),rgba(58,160,255,0.03));padding:18px;border-radius:14px;display:flex;align-items:center;gap:18px;flex-wrap:wrap}
    .hero-text{flex:1;min-width:220px}
    .hero h2{margin:0;font-size:1.25rem}
    .hero p{margin:6px 0;color:#475569}
    .hero-actions{display:flex;gap:10px;align-items:center}
    .btn{appearance:none;border:0;padding:10px 16px;border-radius:10px;background:var(--accent);color:#fff;font-weight:700;cursor:pointer;box-shadow:0 8px 24px rgba(11,87,208,0.12);transition:transform .12s,box-shadow .12s}
    .btn.secondary{background:#fff;color:var(--accent);border:1px solid rgba(11,87,208,0.12);box-shadow:none}
    .btn:hover{transform:translateY(-3px)}
    .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:18px;margin-top:18px;align-items:stretch}
    .card{background:#fff;border-radius:12px;padding:16px;box-shadow:0 10px 30px rgba(20,28,46,0.06);display:flex;flex-direction:column;gap:12px;align-items:stretch}
    .top-row{display:flex;gap:12px;align-items:center}
    .icon{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,rgba(11,87,208,0.08),#eaf4ff);display:flex;align-items:center;justify-content:center;font-weight:800;color:var(--accent);font-size:1.05rem;flex:0 0 64px}
    .card-body{flex:1 1 auto;display:flex;flex-direction:column;gap:6px;justify-content:center}
    .card-title{font-weight:800;font-size:1rem;color:#0f1724}
    .card-desc{color:#64748b;font-size:0.95rem}
    .card-cta{display:block;margin-top:6px}
    .btn.small{padding:10px 12px;border-radius:10px;width:100%;text-align:center}
    .board{margin-top:18px}
    .sets{display:flex;flex-wrap:wrap;gap:18px;justify-content:center}
    .set{display:flex;flex-direction:column;align-items:center;gap:8px;padding:8px;min-width:120px}
    .circle{width:var(--cell-size);height:var(--cell-size);border-radius:50%;display:inline-flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
    .dark-yellow{background:#FFD700;color:#222}
    .blue{background:#2f6fff}
    .red{background:#f24d4d}
    .gray{background:#9aa0a6}
    .green{background:#2fbf4a}
    .note{margin-top:14px;color:#475569}
    .banner{margin:22px 0;text-align:center}
    footer{margin-top:26px;padding-top:16px;border-top:1px solid #eef2ff;color:#64748b;font-size:0.95rem}
    @media (max-width:720px){:root{--cell-size:36px}.wrap{padding:16px}.hero{padding:12px}.cards{gap:10px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">L</div>
        <div>
          <h1>LottoAI</h1>
          <div style="color:#64748b;font-size:0.92rem">간편 로또 번호 생성기 · 외부 게임 모음</div>
        </div>
      </div>
      <nav>
        <a href="index.html">홈</a>
        <a href="#games">게임</a>
        <a href="#about">정보</a>
      </nav>
    </header>

    <section class="hero">
      <div class="hero-text">
        <h2>5세트의 로또 번호를 즉시 생성하세요</h2>
        <p>깔끔한 반응형 디자인으로 모바일에서도 편하게 사용하실 수 있습니다. 1213회 당첨번호 학습모델하여 생성한 로또 번호를 로그인 없이 확인해보세요.</p>
      </div>
      <div class="hero-actions">
        <button id="resampleModelBtn" class="btn">모델로 5세트 생성</button>
        <label style="display:flex;align-items:center;gap:8px;color:#475569;font-size:0.95rem">
          <span>쿨다운(분)</span>
          <input id="cooldownMinutes" type="number" min="1" step="1" value="1" style="width:90px;padding:6px;border-radius:8px;border:1px solid #e6eefc" />
        </label>
      </div>
        <div id="nextAllowedInfo" style="margin-top:8px;text-align:center;color:#0b57d0;font-weight:600"></div>
    </section>

    <!-- games section moved below the lotto results -->

    <section class="board" id="lotto">
      <div id="displayRound" style="text-align:center;color:#0b57d0;font-weight:700;margin-bottom:6px"></div>
      <div style="text-align:center;color:#64748b;font-size:0.95rem;margin-bottom:12px;">로또번호 정보만 제공하며, 책임은 본인에게 있습니다.</div>
      <!-- result removed: random-generated sets disabled -->

      <section id="prediction" style="margin-top:18px;text-align:center">
        <div id="modelSets" style="display:flex;gap:18px;justify-content:center;flex-wrap:wrap;margin-top:12px;"></div>
        <div style="color:#64748b;font-size:0.9rem;margin-top:10px">위 숫자는 모델 기반 샘플링으로 생성된 5세트입니다. 참고용입니다.</div>
      </section>
    </section>

    <div id="after-lotto">
      <section id="games" class="cards" aria-label="외부 게임 목록">
        <article class="card">
          <div class="card-body">
            <div class="card-title">오목&빙고 게임</div>
            <div class="card-desc">오목과 빙고 게임 열기</div>
          </div>
          <div class="card-cta"><a href="https://k-trip.streamlit.app/Gomoku_&_Bingo_Game" target="_blank" rel="noopener noreferrer" class="btn small">열기</a></div>
        </article>

        <article class="card">
          <div class="card-body">
            <div class="card-title">Number_Game</div>
            <div class="card-desc">숫자 맞추기 게임</div>
          </div>
          <div class="card-cta"><a href="https://k-trip.streamlit.app/Number_Game" target="_blank" rel="noopener noreferrer" class="btn small">열기</a></div>
        </article>

        <article class="card">
          <div class="card-body">
            <div class="card-title">Simple_Quiz_Game</div>
            <div class="card-desc">간단한 퀴즈 게임</div>
          </div>
          <div class="card-cta"><a href="https://k-trip.streamlit.app/Simple_Quiz_Game" target="_blank" rel="noopener noreferrer" class="btn small">열기</a></div>
        </article>

        <article class="card">
          <div class="card-body">
            <div class="card-title">Google_Map</div>
            <div class="card-desc">지도와 위치 탐색</div>
          </div>
          <div class="card-cta"><a href="https://k-trip.streamlit.app/Google_Map" target="_blank" rel="noopener noreferrer" class="btn small">열기</a></div>
        </article>
      </section>

    <div class="banner">
      <iframe src="https://coupa.ng/cf3Jkx" width="320" height="90" frameborder="0" scrolling="no" referrerpolicy="unsafe-url"></iframe>
    </div>

    <section style="margin-top:18px;padding-top:12px;border-top:1px solid #eef2ff">
      <h3 id="about" style="margin:6px 0">정보</h3>
      <p style="color:#64748b">로또AI는 간단한 번호 생성 도구입니다. 외부 링크는 별도 서비스로 연결됩니다.</p>
    </section>

    <footer>
      © 2026 LottoAI · 제공된 외부 링크는 원 서비스의 소유자에 속합니다.
    </footer>
  </div>

  <script>
    // 날짜 및 회차 계산 (기준일: 2024-08-24)
    (function(){
      const startDate = new Date(Date.UTC(2024,7,24)); // month 7 = Aug (0-indexed)
      const now = new Date();
      // find the most recent Saturday (including today if Saturday)
      const weekday = now.getDay(); // 0=Sun..6=Sat
      const daysSinceSat = (weekday + 1) % 7; // 0 if Saturday
      const lastSat = new Date(now.getFullYear(), now.getMonth(), now.getDate() - daysSinceSat);
      lastSat.setHours(0,0,0,0);

      const diffDays = Math.floor((Date.UTC(lastSat.getFullYear(), lastSat.getMonth(), lastSat.getDate()) - startDate.getTime()) / (24*3600*1000));
      const weeks = Math.floor(diffDays / 7);
      const startRound = 1135;
      const baseRound = startRound + weeks; // round at last Saturday

      // Decide display round: if today is Monday..Friday then show next round (baseRound+1),
      // if today is Saturday or Sunday show baseRound.
      const todayWeek = now.getDay();
      const displayRound = (todayWeek >= 1 && todayWeek <= 5) ? baseRound + 1 : baseRound;

      // draw date: if displaying baseRound -> lastSat, else next Saturday
      const drawDate = new Date(lastSat.getTime());
      if(displayRound > baseRound) drawDate.setDate(drawDate.getDate() + 7);

      const y = drawDate.getFullYear();
      const m = String(drawDate.getMonth()+1).padStart(2,'0');
      const d = String(drawDate.getDate()).padStart(2,'0');
      const dateStr = `${y}.${m}.${d}`;

      const roundText = `${displayRound}회차 (${dateStr})`;
      const displayEl = document.getElementById('displayRound');
      if(displayEl) displayEl.textContent = roundText;
    })();

    function colorClass(n){
      if(n>=1 && n<=10) return 'dark-yellow';
      if(n<=20) return 'blue';
      if(n<=30) return 'red';
      if(n<=40) return 'gray';
      return 'green';
    }
    
    function formatProb(p){
      if(!isFinite(p) || p<=0) return '0.0000%';
      return (p*100).toFixed(4) + '%';
    }
    

  // function to load model probabilities and sample 5 sets
  function generateModelSets(){
    fetch('models/last_prediction.json')
      .then(r=>r.json())
      .then(data=>{
        const probs = data.probs || [];
        function sampleOneSet(){
          const p = probs.slice();
          const chosen = [];
          for(let k=0;k<6;k++){
            const sum = p.reduce((a,b)=>a+b,0);
            if(sum<=0) break;
            const r = Math.random()*sum;
            let acc = 0;
            let idx = -1;
            for(let i=0;i<p.length;i++){
              acc += p[i];
              if(acc>=r){ idx=i; break; }
            }
            if(idx===-1){ idx = p.findIndex(v=>v>0); }
            if(idx===-1) break;
            chosen.push(idx+1);
            p[idx]=0;
          }
          return chosen.sort((a,b)=>a-b);
        }

        const sets = [];
        for(let s=0;s<5;s++) sets.push(sampleOneSet());

        const root = document.getElementById('modelSets');
        if(!root) return;
        root.innerHTML='';
        sets.forEach((set,idx)=>{
          const card = document.createElement('div');
          card.style.display='flex';
          card.style.flexDirection='column';
          card.style.alignItems='center';
          card.style.gap='8px';
          card.style.padding='8px';
          card.style.background='#fff';
          card.style.borderRadius='10px';
          card.style.boxShadow='0 6px 18px rgba(15,23,36,0.06)';

          const label = document.createElement('div');
          label.textContent = (idx+1) + '세트';
          label.style.fontWeight = '700';

          // compute simple joint probability (approximate) as product of per-number probs
          const prob = set.reduce((acc,n)=>acc * (probs[n-1] || 0), 1);
          const probDiv = document.createElement('div');
          probDiv.style.fontSize = '0.85rem';
          probDiv.style.color = '#64748b';
          probDiv.textContent = '당첨확률: ' + formatProb(prob);

          const numsWrap = document.createElement('div');
          numsWrap.style.display='flex';
          numsWrap.style.gap='8px';
          set.forEach(n=>{
            const c = document.createElement('div');
            c.className = 'circle ' + colorClass(n);
            c.textContent = n;
            numsWrap.appendChild(c);
          });

          card.appendChild(label);
          card.appendChild(probDiv);
          card.appendChild(numsWrap);
          root.appendChild(card);
        });
      })
      .catch(err=>{ console.warn('prediction load failed', err); });
  }

  // Weekly generation control (one generation per week, week starts on Monday)
  // cooldown in minutes control
  function getCooldownMinutes(){
    const stored = localStorage.getItem('modelCooldownMinutes');
    if(stored) return parseInt(stored,10);
    return 10080; // default 7 days
  }

  function setCooldownMinutes(v){
    localStorage.setItem('modelCooldownMinutes', String(v));
  }

  function canGenerateNow(){
    const stored = localStorage.getItem('lastModelGen');
    // if running locally (dev), use minute-based cooldown; otherwise use weekly Monday rule
    const hostname = window.location.hostname;
    const isLocal = hostname==='localhost' || hostname==='127.0.0.1' || window.location.protocol==='file:';
    if(isLocal){
      if(!stored) return true;
      const last = new Date(stored);
      const cooldown = getCooldownMinutes();
      const nextAllowed = new Date(last.getTime() + cooldown*60*1000);
      return new Date() >= nextAllowed;
    } else {
      if(!stored) return true;
      const last = new Date(stored);
      function getMonday(dt){
        const d = new Date(dt);
        const day = d.getDay();
        const diff = (day + 6) % 7; // days since Monday
        d.setDate(d.getDate() - diff);
        d.setHours(0,0,0,0);
        return d;
      }
      const lastMon = getMonday(last);
      const nowMon = getMonday(new Date());
      return lastMon < nowMon;
    }
  }

  function markGeneratedNow(){
    localStorage.setItem('lastModelGen', new Date().toISOString());
  }

  const resampleBtn = document.getElementById('resampleModelBtn');
  const cooldownInput = document.getElementById('cooldownMinutes');

  function updateButtonState(){
    if(!resampleBtn) return;
    const stored = localStorage.getItem('lastModelGen');
    const hostname = window.location.hostname;
    const isLocal = hostname==='localhost' || hostname==='127.0.0.1' || window.location.protocol==='file:';
    if(!stored){
      resampleBtn.disabled = false;
      resampleBtn.textContent = isLocal ? '모델로 5세트 생성' : '모델로 5세트 생성 (월요일만)';
      resampleBtn.classList.remove('btn','secondary');
      resampleBtn.classList.add('btn');
      return;
    }
    const last = new Date(stored);
    if(isLocal){
      const cooldown = getCooldownMinutes();
      const nextAllowed = new Date(last.getTime() + cooldown*60*1000);
      if(new Date() >= nextAllowed){
        resampleBtn.disabled = false;
        resampleBtn.textContent = '모델로 5세트 생성';
        resampleBtn.classList.remove('btn','secondary');
        resampleBtn.classList.add('btn');
      } else {
        resampleBtn.disabled = true;
        resampleBtn.textContent = '다음 생성: ' + nextAllowed.toLocaleString();
        resampleBtn.classList.remove('btn');
        resampleBtn.classList.add('btn','secondary');
      }
    } else {
      function getMonday(dt){
        const d = new Date(dt);
        const day = d.getDay();
        const diff = (day + 6) % 7;
        d.setDate(d.getDate() - diff);
        d.setHours(0,0,0,0);
        return d;
      }
      const lastMon = getMonday(last);
      const nowMon = getMonday(new Date());
      if(lastMon < nowMon){
        resampleBtn.disabled = false;
        resampleBtn.textContent = '모델로 5세트 생성 (월요일만)';
        resampleBtn.classList.remove('btn','secondary');
        resampleBtn.classList.add('btn');
      } else {
        const nextMon = new Date(nowMon.getTime());
        nextMon.setDate(nextMon.getDate() + 7);
        resampleBtn.disabled = true;
        resampleBtn.textContent = '다음 생성: ' + nextMon.toLocaleString();
        resampleBtn.classList.remove('btn');
        resampleBtn.classList.add('btn','secondary');
      }
    }
  }

  if(cooldownInput){
    // initialize input from storage
    const v = getCooldownMinutes();
    cooldownInput.value = v;
    cooldownInput.addEventListener('change', function(){
      const val = parseInt(this.value,10) || 0;
      setCooldownMinutes(val);
      updateButtonState();
    });
  }

  if(resampleBtn){
    resampleBtn.addEventListener('click', function(){
      if(!canGenerateNow()){
        alert('아직 쿨다운이 남아 있습니다. 다음 생성 가능 시간을 확인하세요.');
        updateButtonState();
        return;
      }
      generateModelSets();
      markGeneratedNow();
      updateButtonState();
      updateNextAllowedDisplay();
    });
  }


  // set initial button state
  updateButtonState();
  // show next-allowed info and start countdown if needed
  let __countdownInterval = null;
  function pad2(v){ return String(v).padStart(2,'0'); }
  function formatDateTime(dt){
    const y = dt.getFullYear();
    const m = String(dt.getMonth()+1).padStart(2,'0');
    const d = String(dt.getDate()).padStart(2,'0');
    const hh = pad2(dt.getHours());
    const mm = pad2(dt.getMinutes());
    const ss = pad2(dt.getSeconds());
    return `${y}.${m}.${d} ${hh}:${mm}:${ss}`;
  }
  function formatRemaining(ms){
    if(ms <= 0) return '00:00:00';
    const sec = Math.floor(ms/1000);
    const days = Math.floor(sec / 86400);
    const hours = Math.floor((sec % 86400) / 3600);
    const minutes = Math.floor((sec % 3600) / 60);
    const seconds = sec % 60;
    if(days>0) return `${days}일 ${pad2(hours)}시 ${pad2(minutes)}분 ${pad2(seconds)}초`;
    return `${pad2(hours)}:${pad2(minutes)}:${pad2(seconds)}`;
  }
  function clearCountdown(){ if(__countdownInterval){ clearInterval(__countdownInterval); __countdownInterval = null; } }
  function updateNextAllowedDisplay(){
    const el = document.getElementById('nextAllowedInfo');
    if(!el) return;
    const stored = localStorage.getItem('lastModelGen');
    if(!stored){ el.textContent = ''; clearCountdown(); return; }
    const last = new Date(stored);
    const cooldown = getCooldownMinutes();
    const nextAllowed = new Date(last.getTime() + cooldown*60*1000);
    clearCountdown();
    function tick(){
      const now = new Date();
      const remaining = nextAllowed.getTime() - now.getTime();
      if(remaining <= 0){
        el.innerHTML = `다음 생성: ${formatDateTime(nextAllowed)} &nbsp; <strong style="color:#07801a">(생성 가능)</strong>`;
        clearCountdown();
        updateButtonState();
        return;
      }
      el.innerHTML = `다음 생성: ${formatDateTime(nextAllowed)} &nbsp; | &nbsp; 남은 시간: ${formatRemaining(remaining)}`;
    }
    tick();
    __countdownInterval = setInterval(tick, 1000);
  }

  if(cooldownInput){ cooldownInput.addEventListener('change', updateNextAllowedDisplay); }
  // initialize countdown display
  updateNextAllowedDisplay();
  // render initial sets from latest prediction JSON
  generateModelSets();
  </script>
</body>
</html>